<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.M. - El Libro Rojo</title>

    <!-- SEO & Meta Tags -->
    <meta name="description"
        content="Un sistema de gestión de gestas épicas. Vence a la Sombra completando misiones, desbloquea logros y domina el arte de la productividad.">
    <meta name="author" content="S.A.M. - El Libro Rojo">
    <meta name="keywords" content="productividad, gamificación, IA, gestas, misiones, RPG">

    <!-- Open Graph (Facebook, Discord, WhatsApp) -->
    <meta property="og:title" content="S.A.M. - ¿Podrás vencer a la Sombra?">
    <meta property="og:description"
        content="Un viaje épico hacia la productividad. Completa misiones, desbloquea logros y conviértete en leyenda.">
    <meta property="og:image"
        content="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 1200 630%22><rect fill=%22%230f172a%22 width=%221200%22 height=%22630%22/><text x=%22600%22 y=%22300%22 font-size=%22120%22 fill=%22%23fbbf24%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22>📜 S.A.M.</text><text x=%22600%22 y=%22450%22 font-size=%2240%22 fill=%22%23e2e8f0%22 text-anchor=%22middle%22>El Libro Rojo</text></svg>">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="es_ES">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="S.A.M. - ¿Podrás vencer a la Sombra?">
    <meta name="twitter:description"
        content="Completa misiones épicas y vence a la Sombra. Gamificación + IA para la productividad.">

    <!-- Safety Globals -->
    <script>
        window.logoutUser = window.logoutUser || function (b) { console.log("⏳ Esperando a que el Libro cargue sus secretos..."); };
        window.toggleMode = window.toggleMode || function (m) { console.log("⏳ Preparando la Forja..."); };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📜</text></svg>">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📜</text></svg>">
    <meta name="theme-color" content="#fbbf24">

    <!-- Tipografía: Cinzel (épica) + Lora (cuerpo) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Lora:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Estilos -->
    <link rel="stylesheet" href="css/styles.css">

</head>

<body
    class="h-screen flex flex-col items-center justify-center overflow-hidden transition-colors duration-1000 warm-mode">
    <div id="toastContainer"></div>

    <!-- Splash Screen -->
    <div id="splashScreen"
        class="fixed inset-0 z-[1000] bg-slate-950 flex flex-col items-center justify-center transition-opacity duration-700">
        <div class="text-6xl mb-4 animate-bounce">📜</div>
        <h1 class="text-2xl font-bold text-amber-500 tracking-[0.25em] animate-pulse">S.A.M. EL LIBRO ROJO</h1>
        <p class="text-slate-500 text-xs mt-4 italic">"Un viaje épico hacia la productividad..."</p>
    </div>



    <div
        class="app-shell-premium w-full max-w-2xl h-[92svh] glass-panel rounded-xl shadow-2xl flex flex-col relative transition-all duration-500 overflow-hidden">

        <header class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-900/50 rounded-t-xl">
            <div class="flex items-center">
                <h1 class="text-2xl font-bold text-amber-400 tracking-[0.2em] drop-shadow-lg">S.A.M. EL LIBRO ROJO</h1>
            </div>
            <div class="flex items-center gap-3">
                <!-- Botón TFM Showcase -->
                <a href="tfm-showcase.html"
                    class="h-8 px-3 rounded-full bg-slate-900/40 border border-amber-700/50 flex items-center justify-center text-amber-300 hover:bg-slate-800 transition-colors text-[11px] font-bold tracking-wider"
                    title="Ver presentación visual del TFM">
                    TFM
                </a>
                <!-- Botón de Guía -->
                <button onclick="showGuide()"
                    class="w-8 h-8 rounded-full bg-amber-900/30 border border-amber-600/50 flex items-center justify-center text-amber-500 hover:bg-amber-800 transition-colors"
                    title="Manual de Supervivencia">
                    <span>📖</span>
                </button>
                <!-- El Ojo del Palantír -->
                <div id="palantirContainer" class="relative palantir-container mr-2">
                    <div id="palantirOrb"
                        class="w-8 h-8 rounded-full border-2 border-white/20 flex items-center justify-center cursor-pointer bg-blue-500 palantir-orb"
                        style="animation-name: glow-blue;">
                        <div class="w-3 h-3 bg-white rounded-full"></div>
                    </div>
                    <div id="palantirSuggestion"
                        class="palantir-suggestion absolute top-full right-0 mt-2 w-64 p-3 rounded-lg text-xs text-center shadow-2xl">
                        <p class="text-[9px] text-blue-300/60 uppercase tracking-widest mb-1.5">✦ El Consejo del Palantír ✦</p>
                        <p id="palantirAlerta" class="font-bold mb-1"></p>
                        <p id="palantirSugerencia" class="italic"></p>
                    </div>
                </div>
                <!-- SIMPLIFICADO: Solo Palantír, sin datos de usuario -->
            </div>
        </header>

        <!-- Panel del Juicio de Gandalf — Recordatorio de cierre de día -->
        <!-- Empieza en top-16 (64px) para quedar debajo del header/barra de vida -->
        <div id="gandalfModal"
            class="hidden absolute left-0 right-0 bottom-0 z-10 gandalf-modal flex flex-col" style="top:64px">
            <div class="flex-1 flex flex-col p-4 overflow-hidden">

                <!-- Cabecera: título + descripción + botón cerrar -->
                <div class="flex items-start gap-3 mb-2">
                    <div class="flex-1">
                        <h2 class="text-base font-bold text-amber-900 leading-tight">⚖️ Cierre del Día</h2>
                        <p class="text-[11px] text-amber-800/80 mt-1 leading-snug">Tienes gestas de ayer sin resolver.
                            Ciérralas aquí o pulsa <strong>✕</strong> para hacerlo después desde las tarjetas.</p>
                    </div>
                    <button id="cerrarJuicioBtn"
                        class="text-amber-800 hover:text-amber-600 text-2xl leading-none font-bold flex-shrink-0 px-1"
                        title="Cerrar recordatorio">✕</button>
                </div>

                <p class="text-[10px] text-amber-800/50 italic border-t border-amber-800/30 pt-2 mb-3">
                    "Un mago nunca llega tarde. Ni pronto. Llega precisamente cuando se lo propone."</p>

                <div id="gandalfTaskList" class="flex-1 overflow-y-auto space-y-3 pr-1">
                    <!-- Las tareas pendientes se inyectarán aquí -->
                </div>

                <button id="sellarJuicioBtn"
                    class="w-full mt-3 bg-amber-800 hover:bg-amber-700 disabled:opacity-60 text-amber-100 font-bold py-3 rounded-lg shadow-lg transition-all">
                    Sellar el Juicio
                </button>
            </div>
        </div>

        <!-- MODAL DE SELECCIÓN DE RAZA (BLOQUE 0) -->
        <div id="raceSelectionModal"
            class="hidden absolute inset-0 z-[100] bg-slate-950/95 flex flex-col items-center justify-center p-6 text-center">
            <h2 id="raceModalTitle" class="text-2xl font-bold text-amber-500 mb-2">¡Vaya, una nueva cara por aquí! Mmh... ¡Bienvenido/a pues! Dime, que desde aquí no te veo muy bien... ¿De qué raza eres?</h2>
            <p id="raceModalSubtitle" class="text-xs text-slate-400 mb-8 italic">Selecciona tu Raza — con la que sientas más afinidad, que te represente... o que percibas que fuiste en una vida pasada.</p>

            <div class="grid grid-cols-2 gap-4 w-full max-w-md">
                <button
                    class="race-opt p-4 glass-panel rounded-lg border border-slate-700 hover:border-amber-500 transition-all flex flex-col items-center group"
                    data-race="Humano">
                    <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">🗡️</span>
                    <span class="font-bold text-amber-100">HUMANO/A</span>
                    <span class="text-[9px] text-slate-500 mt-1">Senda del Rey</span>
                </button>
                <button
                    class="race-opt p-4 glass-panel rounded-lg border border-slate-700 hover:border-amber-500 transition-all flex flex-col items-center group"
                    data-race="Elfo">
                    <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">🏹</span>
                    <span class="font-bold text-amber-100">ELFO/A</span>
                    <span class="text-[9px] text-slate-500 mt-1">Senda Inmortal</span>
                </button>
                <button
                    class="race-opt p-4 glass-panel rounded-lg border border-slate-700 hover:border-amber-500 transition-all flex flex-col items-center group"
                    data-race="Enano">
                    <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">⚒️</span>
                    <span class="font-bold text-amber-100">ENANO/A</span>
                    <span class="text-[9px] text-slate-500 mt-1">Senda de Piedra</span>
                </button>
                <button
                    class="race-opt p-4 glass-panel rounded-lg border border-slate-700 hover:border-amber-500 transition-all flex flex-col items-center group"
                    data-race="Hobbit">
                    <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">🍄</span>
                    <span class="font-bold text-amber-100">HOBBIT</span>
                    <span class="text-[9px] text-slate-500 mt-1">Senda del Hogar</span>
                </button>
            </div>
        </div>

        <!-- Panel Persistente del Mensaje de Sam -->
        <div id="samReplyContainer" class="p-2 border-b border-slate-700"></div>

        <!-- BARRA DE PROGRESO DEL VIAJE (HUD) -->
        <div id="sauronHPContainer"
            class="px-4 py-3 bg-black/60 border-b border-red-900/50 hidden relative overflow-hidden">
            <!-- Partículas de fuego se inyectarán aquí -->
            <div id="fireContainer" class="absolute inset-0 pointer-events-none"></div>

            <div class="flex items-center gap-4 mb-2 relative z-10">
                <div class="balrog-sprite" id="bossIcon">&#x1F30B;</div>
                <div class="flex-1">
                    <div class="flex justify-between items-end mb-1">
                        <span class="text-[10px] text-red-500 font-bold tracking-widest uppercase" id="bossName">Distancia
                            hasta llegar al Monte del Destino</span>
                        <span id="sauronHPText" class="text-[10px] text-red-400 font-mono">100% restante</span>
                    </div>

                    <div class="flex items-center gap-2">
                        <div id="journeyBarTrack" class="relative w-full">
                            <div class="hp-bar-container h-3 rounded-sm w-full">
                                <div id="sauronHPBar" class="hp-bar-fill h-full w-full"></div>
                            </div>
                            <div id="journeyProgressMarker"
                                class="absolute top-1/2 left-0 -translate-y-1/2 -translate-x-1/2 flex items-center gap-1 text-[10px] leading-none pointer-events-none z-20 bg-black/65 px-1.5 py-0.5 rounded-full border border-amber-700/50">
                                <span id="journeyRaceIcon" title="Raza del Portador">&#x1F464;</span>
                                <span id="journeyRingIcon" title="Anillo Único">&#x1F48D;</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- VISTA DE MISIONES (Default) -->
        <main id="taskContainer"
            class="flex-1 px-3 py-2 overflow-y-auto space-y-2 custom-scrollbar transition-opacity duration-300">
            <div class="text-center mt-20 text-slate-600 animate-pulse">
                Consultando el Libro Rojo...
            </div>
        </main>

        <!-- VISTA DE SALA DE GUERRA (Oculta por defecto) -->
        <main id="warRoomContainer"
            class="hidden flex-1 p-4 overflow-y-auto custom-scrollbar vintage-grid war-room-panel relative">
            <h2 class="text-center text-amber-600 font-bold mb-4 tracking-[0.2em] border-b border-amber-900/30 pb-2">
                MAPA TÁCTICO</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- HUMANO -->
                <div class="bg-slate-900/80 p-3 rounded border border-slate-700 shadow-lg">
                    <h3 class="text-xs text-amber-500 mb-2 text-center uppercase">Raza Humana</h3>
                    <div class="relative h-48">
                        <canvas id="raceChartHumano"></canvas>
                    </div>
                </div>

                <!-- ELFO -->
                <div class="bg-slate-900/80 p-3 rounded border border-slate-700 shadow-lg">
                    <h3 class="text-xs text-emerald-400 mb-2 text-center uppercase">Elfos</h3>
                    <div class="relative h-48">
                        <canvas id="raceChartElfo"></canvas>
                    </div>
                </div>

                <!-- ENANO -->
                <div class="bg-slate-900/80 p-3 rounded border border-slate-700 shadow-lg">
                    <h3 class="text-xs text-orange-300 mb-2 text-center uppercase">Enanos</h3>
                    <div class="relative h-48">
                        <canvas id="raceChartEnano"></canvas>
                    </div>
                </div>

                <!-- HOBBIT -->
                <div class="bg-slate-900/80 p-3 rounded border border-slate-700 shadow-lg">
                    <h3 class="text-xs text-yellow-300 mb-2 text-center uppercase">Hobbits</h3>
                    <div class="relative h-48">
                        <canvas id="raceChartHobbit"></canvas>
                    </div>
                </div>
            </div>

            <div class="text-center text-[10px] text-slate-500 italic mt-4">
                "Los datos se actualizan con cada amanecer..."
            </div>
            <div class="mt-3 rounded border border-slate-700/50 bg-black/20 p-3">
                <p class="text-[11px] text-slate-300 leading-relaxed">
                    Aquí ves la guerra semanal por razas. Cada gráfica muestra de lunes a domingo
                    las gestas cumplidas frente a las fallidas para Humanos, Elfos, Enanos y Hobbits.
                </p>
                <p class="text-[10px] text-slate-400 mt-2">
                    Reinicio semanal automático: domingo a las 23:59.
                </p>
            </div>
        </main>

        <!-- VISTA DE MOCHILA -->
        <main id="backpackContainer" class="hidden flex-1 p-4 overflow-y-auto custom-scrollbar vintage-grid">
            <h2 class="text-center text-amber-600 font-bold mb-4 tracking-[0.2em] border-b border-amber-900/30 pb-2">LA
                MOCHILA</h2>
            <div id="inventoryGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <!-- Los items se inyectarán aquí -->
            </div>
            <div id="emptyInventory" class="hidden text-center mt-20 text-slate-600 italic">
                La mochila está vacía... por ahora.
            </div>
        </main>

        <!-- VISTA DE LA FORJA (NUEVA) -->
        <main id="forgeContainer" class="hidden flex-1 p-4 overflow-y-auto custom-scrollbar vintage-grid">
            <h2 class="text-center text-amber-600 font-bold mb-4 tracking-[0.2em] border-b border-amber-900/30 pb-2">
                YUNQUE DE DURIN</h2>
            <div class="bg-black/40 p-3 rounded border border-amber-900/30 mb-6 text-center">
                <p class="text-[10px] text-amber-200/50 italic">"Solo aquellos con materiales raros y paciencia
                    de enano forjarán el destino."</p>
            </div>

            <div id="recipesGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 px-2">
                <!-- Las recetas se cargarán dinámicamente desde JS -->
            </div>
        </main>

        <!-- SECCIÓN DE LOGROS (NUEVA) -->
        <main id="achievementsTab" class="hidden flex-1 overflow-hidden flex flex-col bg-slate-950/20">
            <div class="p-6 flex-1 overflow-y-auto custom-scrollbar">
                <div class="flex items-center justify-between mb-6 border-b border-amber-900/40 pb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-amber-500 tracking-tighter">🏆 LOGROS</h2>
                    </div>
                </div>

                <div id="achievementsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    <!-- Los logros se inyectarán aquí -->
                </div>
            </div>
        </main>

        <!-- MODAL DE DETALLE: PERGAMINO TÉCNICO -->
        <div id="itemDetailModal"
            class="hidden absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-6">
            <div class="gandalf-scroll w-full max-w-sm rounded-lg border-2 border-amber-800 p-6 relative">
                <button id="closeItemDetail" class="absolute top-2 right-4 text-2xl text-amber-900">&times;</button>
                <div class="flex flex-col items-center text-center">
                    <div id="itemDetailIcon" class="text-5xl mb-4">📦</div>
                    <h3 id="itemDetailName" class="text-2xl font-bold border-b border-amber-900/30 pb-2 w-full">Nombre
                        del Item</h3>
                    <p id="itemDetailRarity" class="text-xs uppercase tracking-widest my-2 font-bold text-amber-900">
                        Rareza</p>
                    <div
                        class="bg-amber-900/10 p-4 rounded border border-amber-900/20 italic text-sm mt-2 text-justify">
                        <p id="itemDetailDescription">Descripción técnica del material...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL DE GUÍA: MANUAL DE SAM (NUEVO) -->
        <div id="guideModal"
            class="hidden absolute inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-md p-6">
            <div
                class="guide-panel w-full max-w-lg rounded-lg border border-slate-700 p-8 relative overflow-y-auto max-h-[90vh]">
                <button id="closeGuideBtn"
                    class="absolute top-4 right-6 text-3xl text-amber-300 font-bold">&times;</button>

                <h2 class="text-2xl font-bold border-b border-amber-700/30 pb-2 mb-4 text-center text-amber-300">&#x1F4DC; MANUAL DEL
                    PORTADOR/A</h2>

                <div class="space-y-6 text-sm text-slate-200 leading-relaxed">

                    <!-- CONTEXTO -->
                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-3 text-amber-400">🌍 CONTEXTO: LA TIERRA MEDIA TE NECESITA</h3>
                        <p class="mb-3">Esta aplicación está inspirada en la obra de <strong class="text-amber-300">J.R.R. Tolkien</strong> y en el universo de <em>El Señor de los Anillos</em>. Nos situamos en un momento crucial: la Comunidad del Anillo se reúne en Rivendel, pero el destino da un giro inesperado. Frodo cae gravemente enfermo antes de partir, y el Concilio de Elrond se vuelve hacia ti.</p>
                        <p class="mb-3"><strong class="text-amber-200">Tú serás el/la Portador/a del Anillo.</strong> Sam (S.A.M.) te acompañará fielmente, registrando cada hazaña en el Libro Rojo para la eternidad. El peso del Anillo es tuyo. El destino de la Tierra Media, también.</p>
                        <p class="text-amber-100/80">Pero no caminas solo/a. <strong>Cada usuario de esta aplicación forma parte de la misma cruzada épica.</strong> Cada tarea que completes es un paso colectivo hacia el Monte del Destino: tus victorias y las de tus compañeros/as se suman en una travesía compartida que determina si la luz prevalece sobre la Sombra. Cada pequeña acción importa. La Compañía avanza junta.</p>
                        <p class="text-[11px] text-amber-500/70 italic mt-3">"Incluso la persona más pequeña puede cambiar el curso del futuro." — Galadriel</p>
                    </section>

                    <!-- PRIMEROS PASOS -->
                    <section class="rounded border border-emerald-600/40 bg-emerald-950/30 p-4">
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-3 text-emerald-400">&#x26A1; PRIMEROS PASOS</h3>
                        <ol class="space-y-3 list-none">
                            <li class="flex gap-3 items-start">
                                <span class="text-emerald-400 font-bold text-base leading-tight">1.</span>
                                <div>
                                    <p class="font-semibold text-slate-100">Escribe una tarea real en el cuadro inferior</p>
                                    <p class="text-xs text-slate-400 mt-0.5">Ejemplo: <em>"Estudiar 1 hora de estadística"</em> o <em>"Ir al gimnasio esta tarde"</em></p>
                                </div>
                            </li>
                            <li class="flex gap-3 items-start">
                                <span class="text-emerald-400 font-bold text-base leading-tight">2.</span>
                                <div>
                                    <p class="font-semibold text-slate-100">SAM la convierte en una gesta épica</p>
                                    <p class="text-xs text-slate-400 mt-0.5">Aparecerá en tu diario con nombre, recompensas (Experiencia (XP), oro, materiales) y fecha límite.</p>
                                </div>
                            </li>
                            <li class="flex gap-3 items-start">
                                <span class="text-emerald-400 font-bold text-base leading-tight">3.</span>
                                <div>
                                    <p class="font-semibold text-slate-100">Cuando llegue el momento, juzga la gesta</p>
                                    <p class="text-xs text-slate-400 mt-0.5">Pulsa <strong class="text-emerald-400">Éxito</strong> si la completaste o <strong class="text-red-400">Fallo</strong> si no pudo ser. Sé honesto — la Sombra lo sabe.</p>
                                </div>
                            </li>
                            <li class="flex gap-3 items-start">
                                <span class="text-emerald-400 font-bold text-base leading-tight">4.</span>
                                <div>
                                    <p class="font-semibold text-slate-100">Recoge tus recompensas y evoluciona</p>
                                    <p class="text-xs text-slate-400 mt-0.5">Acumula XP para subir de nivel, oro para la economía del juego y materiales para craftear en la Forja.</p>
                                </div>
                            </li>
                        </ol>
                        <p class="text-xs text-slate-500 mt-3 italic">Las gestas pendientes de hoy aparecen en el Diario. Las gestas viejas sin resolver alimentan la horda de Sauron.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 text-amber-300">&#x1F48D; TU MISIÓN</h3>
                        <p>Frodo enfermó de gravedad tras la herida de la daga de Morgul y no se recupera a tiempo.
                            En el Concilio de Elrond decides alzarte como voluntario/a, y ahora eres el/la Portador/a del
                            Anillo. La misión es clara: no sucumbir ante las fuerzas del mal y llevar el Anillo al Monte del Destino para destruirlo y acabar con la oscuridad que amenaza al mundo.</p>
                    </section>
                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">&#x2694;&#xFE0F; EL
                            CAMINO</h3>
                        <p>Anota tus tareas en el diario. S.A.M. las traducirá a gestas épicas.
                            Cada éxito te acerca al Monte del Destino para destruir el Anillo y acabar con Sauron y
                            las fuerzas de la oscuridad. Además, obtendrás materiales y oro.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">&#x1F480; LA
                            SOMBRA</h3>
                        <p>Si dejas una tarea para mañana, la horda empezará a crecer. Primero exploradores, luego
                            orcos... ¡no dejes que las fuerzas de la oscuridad invadan la Tierra Media!</p>
                        <p class="mt-2">Además, la interfaz se oscurece por niveles cuando acumulas fallos. Cuantos
                            más días arrastres tareas sin resolver, más sombrío se verá el entorno.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">⚒️ LA
                            FORJA</h3>
                        <p>Los materiales que recojas (Hierro, Cuero, Mithril) se pueden usar en el <strong>Yunque de
                                Durin</strong> para crear artefactos que te dan bonos permanentes de XP o protección.
                        </p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">&#x2694;&#xFE0F; EL
                            PALANTÍR</h3>
                        <p>El Palantír no es un adorno: es una IA predictiva con memoria de tus patrones.
                            Aprende cómo actúas, anticipa dónde puedes caer y te lanza advertencias antes de que la
                            Sombra gane terreno.</p>
                        <p class="mt-3">Dicho fácil: te avisa antes del tropiezo para que llegues preparado, no a
                            última hora.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">MAPA
                            TÁCTICO</h3>
                        <p>Las gráficas por raza cubren la semana en curso (lunes a domingo). El recuento se reinicia
                            cada domingo a las 23:59.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">📈
                            EVOLUCIÓN DE CLASE</h3>
                        <p class="text-xs italic opacity-80 mb-4">Niveles de evolución por raza (hitos):
                            1 -> 8 -> 18 -> 25 -> 42 -> 60 -> 75 -> 99</p>
                        <ul class="text-xs space-y-2 list-none p-3 rounded border border-slate-700 bg-slate-950/80 font-bold text-slate-100">
                            <li><strong class="text-amber-300">Humano/a:</strong> Granjero/a → Aventurero/a → Montaraz →
                                Caballero/a → Paladín → Rey/Reina → Señor/a de Gondor → Heredero/a de Isildur</li>
                            <li><strong class="text-emerald-300">Elfo/a:</strong> Novicio/a de Lórien → Explorador/a del
                                Bosque → Guardián/a del Sendero → Arquero/a Maestro/a → Señor/a de los Caballos → Alto/a Consejero/a
                                → Soberano/a Estelar → Señor/a de Rivendel</li>
                            <li><strong class="text-orange-300">Enano/a:</strong> Minero/a de Moria → Picapedrero/a →
                                Herrero/a de Erebor → Guardián/a del Tesoro → Señor/a del Yunque → Gran Escudo de Hierro → Rey/Reina
                                bajo la Montaña → Linaje de Durin</li>
                            <li><strong class="text-yellow-300">Hobbit/a:</strong> Habitante/a del Agujero → Cocinero/a de
                                Bolsón → Buscador/a de Setas → Aventurero/a Local → Héroe/Heroína de la Comarca → Portador/a de la
                                Esperanza → Alcalde/esa de Cavada Grande → Thain de la Comarca</li>
                        </ul>
                    </section>
                </div>

                <div class="mt-4 text-[10px] text-slate-400 space-y-2">
                    <p><strong class="text-amber-500/80">S.A.M.</strong> significa <em>Social Achievement Manager</em>. Su propósito es simple y ambicioso a la vez: transformar las metas cotidianas de cada persona en gestas épicas únicas e irrepetibles.</p>
                    <p>Cada usuario vive su propia aventura. La misma tarea nunca produce la misma gesta: el título, el objetivo y las recompensas que S.A.M. genera son exclusivos para ti, moldeados por lo que escribes y por el momento en que lo haces. No hay dos caminos iguales en el Libro Rojo.</p>
                    <p>Y sin embargo, todos compartimos la misma travesía: cada pequeña victoria tuya suma al esfuerzo colectivo, acercando a la Compañía un paso más al Monte del Destino. Distintos ritmos, distintas gestas, un mismo horizonte.</p>
                </div>
            </div>
        </div>

        <!-- VISTA DE PERFIL (Oculta por defecto) -->
        <main id="profileContainer"
            class="hidden flex-1 p-6 overflow-y-auto custom-scrollbar bg-gradient-to-b from-slate-900 to-slate-950">
            <div class="flex flex-col space-y-6 max-w-2xl mx-auto">

                <!-- ENCABEZADO: RAZA Y NICKNAME -->
                <div class="glass-panel rounded-lg p-6 border border-amber-800/50">
                    <div class="flex items-center gap-6">
                        <div
                            class="w-32 h-32 rounded-full bg-gradient-to-br from-amber-900 to-slate-900 border-4 border-amber-500 flex items-center justify-center shadow-[0_0_20px_rgba(245,158,11,0.4)]">
                            <span class="text-6xl" id="profileRaceIcon">👤</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h2 id="profileEmail" class="text-2xl font-bold text-amber-100">Cargando...</h2>
                                <button id="editNicknameBtn"
                                    class="text-amber-400 hover:text-amber-200 transition-colors" title="Editar nombre"
                                    onclick="mostrarEditarNickname()">
                                    ✏️
                                </button>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="text-sm text-slate-400 uppercase tracking-widest">Raza</span>
                                <p id="playerRace" class="text-lg text-amber-500 font-bold uppercase">Sin Raza</p>
                            </div>
                            <button id="changeRaceBtn"
                                class="text-[11px] px-3 py-1.5 rounded border border-amber-700/50 text-amber-300 hover:bg-amber-900/20 transition-colors font-bold tracking-wide">
                                CAMBIAR RAZA (1.000.000 ORO)
                            </button>
                            <div>
                                <span class="text-xs text-slate-500 uppercase">Estado Actual</span>
                                <p id="profileRaceTitle" class="text-sm text-amber-300 italic font-serif">Aventurero</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ESTADÍSTICAS: NIVEL, XP, ORO -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- NIVEL -->
                    <div class="glass-panel rounded-lg p-4 border border-indigo-600/30 text-center">
                        <div class="text-3xl font-black text-indigo-400 mb-1" id="profileLevel">1</div>
                        <div class="text-xs text-slate-400 uppercase tracking-widest">NIVEL</div>
                    </div>

                    <!-- ORO -->
                    <div class="glass-panel rounded-lg p-4 border border-amber-600/30 text-center">
                        <div class="text-3xl font-black text-amber-400 mb-1" id="profileGold">0</div>
                        <div class="text-xs text-slate-400 uppercase tracking-widest">ORO</div>
                    </div>

                    <!-- LOGROS -->
                    <div class="glass-panel rounded-lg p-4 border border-purple-600/30 text-center">
                        <div class="text-3xl font-black text-purple-400 mb-1" id="profileAchievementsCount">0</div>
                        <div class="text-xs text-slate-400 uppercase tracking-widest">LOGROS</div>
                    </div>
                </div>

                <!-- BARRA DE EXPERIENCIA -->
                <div class="glass-panel rounded-lg p-4 border border-purple-600/30">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs text-slate-400 uppercase tracking-widest">Experiencia</span>
                        <span class="text-xs text-purple-400 font-bold" id="profileXPText">0/1000 XP</span>
                    </div>
                    <div class="w-full bg-slate-800 h-4 rounded-full overflow-hidden border border-purple-700/50">
                        <div id="profileXPBarLarge"
                            class="bg-gradient-to-r from-purple-500 via-indigo-500 to-blue-500 h-full w-0 transition-all duration-1000 shadow-[0_0_10px_rgba(168,85,247,0.5)]">
                        </div>
                    </div>
                    <div class="mt-2 text-[10px] text-slate-500">
                        <span id="profileXPPercent">0%</span> - <span id="profileNextLevel">Próximo nivel: 1000
                            XP</span>
                    </div>
                </div>

                <!-- CERRAR SESIÓN -->
                <div class="glass-panel rounded-lg p-4 border border-red-900/30">
                    <button onclick="logoutUser(this)"
                        class="w-full flex items-center justify-center gap-2 text-red-400 hover:text-red-300 hover:bg-red-950/30 transition-colors py-2 rounded-lg text-sm font-semibold tracking-wider">
                        <span>🚪</span>
                        <span>CERRAR SESIÓN</span>
                    </button>
                </div>

            </div>
        </main>

        <!-- INPUT DEL CHAT (Solo visible en Diario) -->
        <div id="chatFooter" class="p-4 border-t border-slate-700 bg-slate-900/80">
            <div class="flex items-end gap-2">
                <div
                    class="flex-1 flex items-start gap-2 text-amber-500 bg-black/20 p-2 rounded border border-slate-700/50">
                    <span class="pt-2.5">></span>
                    <textarea id="chatInput" class="sam-input placeholder-slate-600 resize-none overflow-y-auto max-h-40"
                        rows="1" placeholder="Escribe tu gesta aquí..." autocomplete="off"></textarea>
                </div>
                <button id="sendGestaBtn"
                    class="bg-amber-600 hover:bg-amber-500 text-black font-bold p-2 px-4 rounded shadow-lg transition-transform active:scale-95 flex items-center justify-center h-10">
                    <span class="text-xs">ENVIAR</span>
                </button>
            </div>
        </div>

        <!-- BARRA DE NAVEGACIÓN (TAB BAR) -->
        <nav
            class="bg-black/60 border-t border-amber-900/30 p-2 flex justify-around items-center rounded-b-xl backdrop-blur-md">
            <button
                class="nav-btn active group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-amber-500"
                data-target="journal">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F4DC;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">DIARIO</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="warRoom">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F5FA;&#xFE0F;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">MAPA</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="profile">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F464;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">PERFIL</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="backpack">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F392;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">MOCHILA</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="forge">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x2692;&#xFE0F;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">FORJA</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="achievementsTab">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F3C6;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">LOGROS</span>
            </button>
        </nav>

    </div>

    <!-- Panel de Desarrollador para Time Mocking -->
    <div id="devPanel" class="hidden dev-panel">
        <h4 class="font-bold mb-2">Máquina del Tiempo</h4>
        <label for="daysOffset">Adelantar Días:</label>
        <input type="number" id="daysOffset" value="0" class="bg-slate-800 text-amber-400 w-16 text-center">
        <button id="timeTravelBtn" class="bg-amber-600 text-black px-2 py-1 rounded">Viajar</button>
    </div>

    <script src="js/frontend/client.js?v=4.0"></script>

    <!-- Service Worker Registration & Easter Eggs -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((reg) => {
                        console.log('✅ Service Worker registrado exitosamente:', reg);
                    })
                    .catch((err) => {
                        console.warn('⚠️ Error registrando Service Worker:', err);
                    });
            });
        }

        // Easter Egg: Comando de créditos en consola
        window.credits = function () {
            console.clear();
            console.log('%c═══════════════════════════════════════════════', 'color: #fbbf24; font-weight: bold');
            console.log('%c🏆 S.A.M. - EL LIBRO ROJO', 'color: #fbbf24; font-size: 16px; font-weight: bold');
            console.log('%c═══════════════════════════════════════════════', 'color: #fbbf24; font-weight: bold');
            console.log('%cForjado por:', 'color: #e2e8f0; font-weight: bold');
            console.log('%cJavier González Olivera', 'color: #fbbf24; font-size: 14px; font-weight: bold');
            console.log('%c', 'color: #e2e8f0');
            console.log('%cTrabajo Final de Máster 2026', 'color: #94a3b8; font-style: italic');
            console.log('%c═══════════════════════════════════════════════', 'color: #fbbf24; font-weight: bold');
            console.log('%c🗡️ "No todo lo que brilla es oro, pero toda gesta cuenta" - Gandalf', 'color: #cbd5e1; font-style: italic');
            console.log('%c═══════════════════════════════════════════════', 'color: #fbbf24; font-weight: bold');
        };
    </script>

</body>

</html>




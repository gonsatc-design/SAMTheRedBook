<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.M. - El Libro Rojo</title>

    <!-- SEO & Meta Tags -->
    <meta name="description"
        content="Un sistema de gestiÃ³n de gestas Ã©picas. Vence a la Sombra completando misiones, desbloquea logros y domina el arte de la productividad.">
    <meta name="author" content="S.A.M. - El Libro Rojo">
    <meta name="keywords" content="productividad, gamificaciÃ³n, IA, gestas, misiones, RPG">

    <!-- Open Graph (Facebook, Discord, WhatsApp) -->
    <meta property="og:title" content="S.A.M. - Â¿PodrÃ¡s vencer a la Sombra?">
    <meta property="og:description"
        content="Un viaje Ã©pico hacia la productividad. Completa misiones, desbloquea logros y conviÃ©rtete en leyenda.">
    <meta property="og:image"
        content="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 1200 630%22><rect fill=%22%230f172a%22 width=%221200%22 height=%22630%22/><text x=%22600%22 y=%22300%22 font-size=%22120%22 fill=%22%23fbbf24%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22>ðŸ“œ S.A.M.</text><text x=%22600%22 y=%22450%22 font-size=%2240%22 fill=%22%23e2e8f0%22 text-anchor=%22middle%22>El Libro Rojo</text></svg>">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="es_ES">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="S.A.M. - Â¿PodrÃ¡s vencer a la Sombra?">
    <meta name="twitter:description"
        content="Completa misiones Ã©picas y vence a la Sombra. GamificaciÃ³n + IA para la productividad.">

    <!-- Safety Globals -->
    <script>
        window.logoutUser = window.logoutUser || function (b) { console.log("â³ Esperando a que el Libro cargue sus secretos..."); };
        window.toggleMode = window.toggleMode || function (m) { console.log("â³ Preparando la Forja..."); };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="index.css">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“œ</text></svg>">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“œ</text></svg>">
    <meta name="theme-color" content="#fbbf24">

    <!-- Estilos -->
    <link rel="stylesheet" href="css/styles.css">

</head>

<body
    class="h-screen flex flex-col items-center justify-center overflow-hidden transition-colors duration-1000 warm-mode">
    <div id="toastContainer"></div>

    <!-- Splash Screen -->
    <div id="splashScreen"
        class="fixed inset-0 z-[1000] bg-slate-950 flex flex-col items-center justify-center transition-opacity duration-700">
        <div class="text-6xl mb-4 animate-bounce">ðŸ“œ</div>
        <h1 class="text-2xl font-bold text-amber-500 tracking-[0.25em] animate-pulse">S.A.M. EL LIBRO ROJO</h1>
        <p class="text-slate-500 text-xs mt-4 italic">"Un viaje Ã©pico hacia la productividad..."</p>
    </div>



    <div
        class="app-shell-premium w-full max-w-2xl h-[92vh] glass-panel rounded-xl shadow-2xl flex flex-col relative transition-all duration-500 overflow-hidden">

        <header class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-900/50 rounded-t-xl">
            <div class="flex items-center">
                <h1 class="text-2xl font-bold text-amber-400 tracking-[0.2em] drop-shadow-lg">S.A.M. EL LIBRO ROJO</h1>
            </div>
            <div class="flex items-center gap-3">
                <!-- BotÃ³n TFM Showcase -->
                <a href="tfm-showcase.html"
                    class="h-8 px-3 rounded-full bg-slate-900/40 border border-amber-700/50 flex items-center justify-center text-amber-300 hover:bg-slate-800 transition-colors text-[11px] font-bold tracking-wider"
                    title="Ver presentaciÃ³n visual del TFM">
                    TFM
                </a>
                <!-- BotÃ³n de GuÃ­a -->
                <button onclick="showGuide()"
                    class="w-8 h-8 rounded-full bg-amber-900/30 border border-amber-600/50 flex items-center justify-center text-amber-500 hover:bg-amber-800 transition-colors"
                    title="Manual de Supervivencia">
                    <span>ðŸ“–</span>
                </button>
                <!-- El Ojo del PalantÃ­r -->
                <div id="palantirContainer" class="relative palantir-container mr-2">
                    <div id="palantirOrb"
                        class="w-8 h-8 rounded-full border-2 border-white/20 flex items-center justify-center cursor-pointer bg-blue-500 palantir-orb"
                        style="animation-name: glow-blue;">
                        <div class="w-3 h-3 bg-white rounded-full"></div>
                    </div>
                    <div id="palantirSuggestion"
                        class="palantir-suggestion absolute top-full right-0 mt-2 w-64 p-3 rounded-lg text-xs text-center shadow-2xl">
                        <p id="palantirAlerta" class="font-bold mb-1"></p>
                        <p id="palantirSugerencia" class="italic"></p>
                    </div>
                </div>
                <!-- SIMPLIFICADO: Solo PalantÃ­r, sin datos de usuario -->
            </div>
        </header>

        <!-- Panel del Juicio de Gandalf (Oculto por defecto) -->
        <div id="gandalfModal"
            class="hidden absolute inset-0 z-10 p-4 flex flex-col items-center justify-center gandalf-modal">
            <div
                class="w-full h-full max-h-[80vh] gandalf-scroll rounded-lg border-2 border-amber-800 flex flex-col p-6">
                <h2 class="text-2xl font-bold text-center mb-4 border-b-2 border-amber-800/30 pb-2">Un Asunto Pendiente
                </h2>
                <p class="text-center text-sm mb-6">"Un mago nunca llega tarde. Ni pronto. Llega
                    precisamente cuando se lo propone. Y hoy me propongo resolver esto."</p>
                <div id="gandalfTaskList" class="flex-1 overflow-y-auto space-y-4 pr-2">
                    <!-- Las tareas pendientes se inyectarÃ¡n aquÃ­ -->
                </div>
                <button id="sellarJuicioBtn"
                    class="w-full mt-6 bg-amber-800 hover:bg-amber-700 text-amber-100 font-bold py-3 rounded-lg shadow-lg">Sellar
                    el Juicio</button>
            </div>
        </div>

        <!-- MODAL DE SELECCIÃ“N DE RAZA (BLOQUE 0) -->
        <div id="raceSelectionModal"
            class="hidden absolute inset-0 z-[100] bg-slate-950/95 flex flex-col items-center justify-center p-6 text-center">
            <h2 id="raceModalTitle" class="text-2xl font-bold text-amber-500 mb-2">Â¿ERES EL PORTADOR DEL ANILLO?</h2>
            <p id="raceModalSubtitle" class="text-xs text-slate-400 mb-8 italic">Solo Sam (S.A.M.) te acompaÃ±a y registrarÃ¡ tus gestas. En
                tus manos estÃ¡ el destino.</p>

            <div class="grid grid-cols-2 gap-4 w-full max-w-md">
                <button
                    class="race-opt p-4 glass-panel rounded-lg border border-slate-700 hover:border-amber-500 transition-all flex flex-col items-center group"
                    data-race="Humano">
                    <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">ðŸ—¡ï¸</span>
                    <span class="font-bold text-amber-100">HUMANO</span>
                    <span class="text-[9px] text-slate-500 mt-1">Senda del Rey</span>
                </button>
                <button
                    class="race-opt p-4 glass-panel rounded-lg border border-slate-700 hover:border-amber-500 transition-all flex flex-col items-center group"
                    data-race="Elfo">
                    <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">ðŸ¹</span>
                    <span class="font-bold text-amber-100">ELFO</span>
                    <span class="text-[9px] text-slate-500 mt-1">Senda Inmortal</span>
                </button>
                <button
                    class="race-opt p-4 glass-panel rounded-lg border border-slate-700 hover:border-amber-500 transition-all flex flex-col items-center group"
                    data-race="Enano">
                    <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">âš’ï¸</span>
                    <span class="font-bold text-amber-100">ENANO</span>
                    <span class="text-[9px] text-slate-500 mt-1">Senda de Piedra</span>
                </button>
                <button
                    class="race-opt p-4 glass-panel rounded-lg border border-slate-700 hover:border-amber-500 transition-all flex flex-col items-center group"
                    data-race="Hobbit">
                    <span class="text-4xl mb-2 group-hover:scale-110 transition-transform">ðŸ„</span>
                    <span class="font-bold text-amber-100">HOBBIT</span>
                    <span class="text-[9px] text-slate-500 mt-1">Senda del Hogar</span>
                </button>
            </div>
        </div>

        <!-- Panel Persistente del Mensaje de Sam -->
        <div id="samReplyContainer" class="p-2 border-b border-slate-700"></div>

        <!-- BARRA DE PROGRESO DEL VIAJE (HUD) -->
        <div id="sauronHPContainer"
            class="px-4 py-3 bg-black/60 border-b border-red-900/50 hidden relative overflow-hidden">
            <!-- PartÃ­culas de fuego se inyectarÃ¡n aquÃ­ -->
            <div id="fireContainer" class="absolute inset-0 pointer-events-none"></div>

            <div class="flex items-center gap-4 mb-2 relative z-10">
                <div class="balrog-sprite" id="bossIcon">&#x1F30B;</div>
                <div class="flex-1">
                    <div class="flex justify-between items-end mb-1">
                        <span class="text-[10px] text-red-500 font-bold tracking-widest uppercase" id="bossName">Distancia
                            hasta llegar al Monte del Destino</span>
                        <span id="sauronHPText" class="text-[10px] text-red-400 font-mono">100% restante</span>
                    </div>

                    <div class="flex items-center gap-2">
                        <div id="journeyBarTrack" class="relative w-full">
                            <div class="hp-bar-container h-3 rounded-sm w-full">
                                <div id="sauronHPBar" class="hp-bar-fill h-full w-full"></div>
                            </div>
                            <div id="journeyProgressMarker"
                                class="absolute top-1/2 left-0 -translate-y-1/2 -translate-x-1/2 flex items-center gap-1 text-[10px] leading-none pointer-events-none z-20 bg-black/65 px-1.5 py-0.5 rounded-full border border-amber-700/50">
                                <span id="journeyRaceIcon" title="Raza del Portador">&#x1F464;</span>
                                <span id="journeyRingIcon" title="Anillo Ãšnico">&#x1F48D;</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- VISTA DE MISIONES (Default) -->
        <main id="taskContainer"
            class="flex-1 px-3 py-2 overflow-y-auto space-y-2 custom-scrollbar transition-opacity duration-300">
            <div class="text-center mt-20 text-slate-600 animate-pulse">
                Consultando el Libro Rojo...
            </div>
        </main>

        <!-- VISTA DE SALA DE GUERRA (Oculta por defecto) -->
        <main id="warRoomContainer"
            class="hidden flex-1 p-4 overflow-y-auto custom-scrollbar vintage-grid war-room-panel relative">
            <h2 class="text-center text-amber-600 font-bold mb-4 tracking-[0.2em] border-b border-amber-900/30 pb-2">
                MAPA TÃCTICO</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- HUMANO -->
                <div class="bg-slate-900/80 p-3 rounded border border-slate-700 shadow-lg">
                    <h3 class="text-xs text-amber-500 mb-2 text-center uppercase">Semana de Humano</h3>
                    <div class="relative h-48">
                        <canvas id="raceChartHumano"></canvas>
                    </div>
                </div>

                <!-- ELFO -->
                <div class="bg-slate-900/80 p-3 rounded border border-slate-700 shadow-lg">
                    <h3 class="text-xs text-emerald-400 mb-2 text-center uppercase">Semana de Elfo</h3>
                    <div class="relative h-48">
                        <canvas id="raceChartElfo"></canvas>
                    </div>
                </div>

                <!-- ENANO -->
                <div class="bg-slate-900/80 p-3 rounded border border-slate-700 shadow-lg">
                    <h3 class="text-xs text-orange-300 mb-2 text-center uppercase">Semana de Enano</h3>
                    <div class="relative h-48">
                        <canvas id="raceChartEnano"></canvas>
                    </div>
                </div>

                <!-- HOBBIT -->
                <div class="bg-slate-900/80 p-3 rounded border border-slate-700 shadow-lg">
                    <h3 class="text-xs text-yellow-300 mb-2 text-center uppercase">Semana de Hobbit</h3>
                    <div class="relative h-48">
                        <canvas id="raceChartHobbit"></canvas>
                    </div>
                </div>
            </div>

            <div class="text-center text-[10px] text-slate-500 italic mt-4">
                "Los datos se actualizan con cada amanecer..."
            </div>
            <div class="mt-3 rounded border border-slate-700/50 bg-black/20 p-3">
                <p class="text-[11px] text-slate-300 leading-relaxed">
                    AquÃ­ ves la guerra semanal por razas. Cada grÃ¡fica muestra de lunes a domingo
                    las gestas cumplidas frente a las fallidas para Humano, Elfo, Enano y Hobbit.
                </p>
                <p class="text-[10px] text-slate-400 mt-2">
                    Reinicio semanal automÃ¡tico: domingo a las 23:59.
                </p>
            </div>
        </main>

        <!-- VISTA DE MOCHILA -->
        <main id="backpackContainer" class="hidden flex-1 p-4 overflow-y-auto custom-scrollbar vintage-grid">
            <h2 class="text-center text-amber-600 font-bold mb-4 tracking-[0.2em] border-b border-amber-900/30 pb-2">LA
                MOCHILA</h2>
            <div id="inventoryGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <!-- Los items se inyectarÃ¡n aquÃ­ -->
            </div>
            <div id="emptyInventory" class="hidden text-center mt-20 text-slate-600 italic">
                La mochila estÃ¡ vacÃ­a... por ahora.
            </div>
        </main>

        <!-- VISTA DE LA FORJA (NUEVA) -->
        <main id="forgeContainer" class="hidden flex-1 p-4 overflow-y-auto custom-scrollbar vintage-grid">
            <h2 class="text-center text-amber-600 font-bold mb-4 tracking-[0.2em] border-b border-amber-900/30 pb-2">
                YUNQUE DE DURIN</h2>
            <div class="bg-black/40 p-3 rounded border border-amber-900/30 mb-6 text-center">
                <p class="text-[10px] text-amber-200/50 italic">"Solo aquellos con materiales raros y paciencia
                    de enano forjarÃ¡n el destino."</p>
            </div>

            <div id="recipesGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 px-2">
                <!-- Las recetas se cargarÃ¡n dinÃ¡micamente desde JS -->
            </div>
        </main>

        <!-- SECCIÃ“N DE LOGROS (NUEVA) -->
        <main id="achievementsTab" class="hidden flex-1 overflow-hidden flex flex-col bg-slate-950/20">
            <div class="p-6 flex-1 overflow-y-auto custom-scrollbar">
                <div class="flex items-center justify-between mb-6 border-b border-amber-900/40 pb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-amber-500 tracking-tighter">ðŸ›ï¸ LOGROS</h2>
                    </div>
                </div>

                <div id="achievementsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    <!-- Los logros se inyectarÃ¡n aquÃ­ -->
                </div>
            </div>
        </main>

        <!-- MODAL DE DETALLE: PERGAMINO TÃ‰CNICO -->
        <div id="itemDetailModal"
            class="hidden absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-6">
            <div class="gandalf-scroll w-full max-w-sm rounded-lg border-2 border-amber-800 p-6 relative">
                <button id="closeItemDetail" class="absolute top-2 right-4 text-2xl text-amber-900">&times;</button>
                <div class="flex flex-col items-center text-center">
                    <div id="itemDetailIcon" class="text-5xl mb-4">ðŸ“¦</div>
                    <h3 id="itemDetailName" class="text-2xl font-bold border-b border-amber-900/30 pb-2 w-full">Nombre
                        del Item</h3>
                    <p id="itemDetailRarity" class="text-xs uppercase tracking-widest my-2 font-bold text-amber-900">
                        Rareza</p>
                    <div
                        class="bg-amber-900/10 p-4 rounded border border-amber-900/20 italic text-sm mt-2 text-justify">
                        <p id="itemDetailDescription">DescripciÃ³n tÃ©cnica del material...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL DE GUÃA: MANUAL DE SAM (NUEVO) -->
        <div id="guideModal"
            class="hidden absolute inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-md p-6">
            <div
                class="guide-panel w-full max-w-lg rounded-lg border border-slate-700 p-8 relative overflow-y-auto max-h-[90vh]">
                <button id="closeGuideBtn"
                    class="absolute top-4 right-6 text-3xl text-amber-300 font-bold">&times;</button>

                <h2 class="text-2xl font-bold border-b border-amber-700/30 pb-2 mb-4 text-center text-amber-300">&#x1F4DC; MANUAL DEL
                    PORTADOR</h2>

                <div class="space-y-6 text-sm text-slate-200 leading-relaxed">
                    <section class="rounded border border-amber-700/30 bg-slate-900/70 p-3">
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 text-amber-300">&#x1F48D; TU MISIÃ“N</h3>
                        <p>Frodo enfermÃ³ de gravedad tras la herida de la daga de Morgul y no se recupera a tiempo.
                            En el Concilio de Elrond decides alzarte como voluntario, y ahora eres el Portador del
                            Anillo. Solo S.A.M. (<strong>Social Achievement Manager</strong>) te acompaÃ±a y registrarÃ¡ cada gesta en el
                            Libro Rojo para la eternidad.
                            En tus manos estÃ¡ el destino.</p>
                    </section>
                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">&#x2694;&#xFE0F; EL
                            CAMINO</h3>
                        <p>Anota tus tareas en el diario. S.A.M. las traducirÃ¡ a gestas Ã©picas.
                            Cada Ã©xito te acerca al Monte del Destino para destruir el Anillo y acabar con Sauron y
                            las fuerzas de la oscuridad. AdemÃ¡s, obtendrÃ¡s materiales y oro.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">&#x1F480; LA
                            SOMBRA</h3>
                        <p>Si dejas una tarea para maÃ±ana, la horda empezarÃ¡ a crecer. Primero exploradores, luego
                            orcos... Â¡no dejes que las fuerzas de la oscuridad invadan la Tierra Media!</p>
                        <p class="mt-2">AdemÃ¡s, la interfaz se oscurece por niveles cuando acumulas fallos. Cuantos
                            mÃ¡s dÃ­as arrastres tareas sin resolver, mÃ¡s sombrÃ­o se verÃ¡ el entorno.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">âš’ï¸ LA
                            FORJA</h3>
                        <p>Los materiales que recojas (Hierro, Cuero, Mithril) se pueden usar en el <strong>Yunque de
                                Durin</strong> para crear artefactos que te dan bonos permanentes de XP o protecciÃ³n.
                        </p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">&#x2694;&#xFE0F; EL
                            PALANTÃR</h3>
                        <p>El PalantÃ­r no es un adorno: es una IA predictiva con memoria de tus patrones.
                            Aprende cÃ³mo actÃºas, anticipa dÃ³nde puedes caer y te lanza advertencias antes de que la
                            Sombra gane terreno.</p>
                        <p class="mt-3">Dicho fÃ¡cil: te avisa antes del tropiezo para que llegues preparado, no a
                            Ãºltima hora.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">MAPA
                            TÃCTICO</h3>
                        <p>Las grÃ¡ficas por raza cubren la semana en curso (lunes a domingo). El recuento se reinicia
                            cada domingo a las 23:59.</p>
                    </section>

                    <section>
                        <h3 class="font-bold uppercase text-xs tracking-widest mb-2 border-b border-slate-700">ðŸ“ˆ
                            EVOLUCIÃ“N DE CLASE</h3>
                        <p class="text-xs italic opacity-80 mb-4">Niveles de evoluciÃ³n por raza (hitos):
                            1 -> 8 -> 18 -> 25 -> 42 -> 60 -> 75 -> 99</p>
                        <ul class="text-xs space-y-2 list-none p-3 rounded border border-slate-700 bg-slate-950/80 font-bold text-slate-100">
                            <li><strong class="text-amber-300">Humano:</strong> Granjero â†’ Aventurero â†’ Montaraz â†’
                                Caballero â†’ PaladÃ­n â†’ Rey</li>
                            <li><strong class="text-emerald-300">Elfo:</strong> Novicio de LÃ³rien â†’ Explorador del
                                Bosque â†’ GuardiÃ¡n del Sendero â†’ Arquero Maestro â†’ SeÃ±or de los Caballos â†’ Alto Consejero
                                â†’ Soberano Estelar â†’ SeÃ±or de Rivendel</li>
                            <li><strong class="text-orange-300">Enano:</strong> Minero de Moria â†’ Picapedrero â†’
                                Herrero de Erebor â†’ GuardiÃ¡n del Tesoro â†’ SeÃ±or del Yunque â†’ Gran Escudo de Hierro â†’ Rey
                                bajo la MontaÃ±a â†’ Linaje de Durin</li>
                            <li><strong class="text-yellow-300">Hobbit:</strong> Habitante del Agujero â†’ Cocinero de
                                BolsÃ³n â†’ Buscador de Setas â†’ Aventurero Local â†’ HÃ©roe de la Comarca â†’ Portador de la
                                Esperanza â†’ Alcalde de Cavada Grande â†’ Thain de la Comarca</li>
                        </ul>
                    </section>
                </div>

                <div class="mt-8 text-center text-[10px] italic opacity-60">"Incluso la persona mÃ¡s pequeÃ±a puede
                    cambiar el curso del futuro."</div>
            </div>
        </div>

        <!-- VISTA DE PERFIL (Oculta por defecto) -->
        <main id="profileContainer"
            class="hidden flex-1 p-6 overflow-y-auto custom-scrollbar bg-gradient-to-b from-slate-900 to-slate-950">
            <div class="flex flex-col space-y-6 max-w-2xl mx-auto">

                <!-- ENCABEZADO: RAZA Y NICKNAME -->
                <div class="glass-panel rounded-lg p-6 border border-amber-800/50">
                    <div class="flex items-center gap-6">
                        <div
                            class="w-32 h-32 rounded-full bg-gradient-to-br from-amber-900 to-slate-900 border-4 border-amber-500 flex items-center justify-center shadow-[0_0_20px_rgba(245,158,11,0.4)]">
                            <span class="text-6xl" id="profileRaceIcon">ðŸ‘¤</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h2 id="profileEmail" class="text-2xl font-bold text-amber-100">Cargando...</h2>
                                <button id="editNicknameBtn"
                                    class="text-amber-400 hover:text-amber-200 transition-colors" title="Editar nombre"
                                    onclick="mostrarEditarNickname()">
                                    âœï¸
                                </button>
                            </div>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="text-sm text-slate-400 uppercase tracking-widest">Raza</span>
                                <p id="playerRace" class="text-lg text-amber-500 font-bold uppercase">Sin Raza</p>
                            </div>
                            <button id="changeRaceBtn"
                                class="text-[11px] px-3 py-1.5 rounded border border-amber-700/50 text-amber-300 hover:bg-amber-900/20 transition-colors font-bold tracking-wide">
                                CAMBIAR RAZA (1.000.000 ORO)
                            </button>
                            <div>
                                <span class="text-xs text-slate-500 uppercase">Estado Actual</span>
                                <p id="profileRaceTitle" class="text-sm text-amber-300 italic font-serif">Aventurero</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ESTADÃSTICAS: NIVEL, XP, ORO -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- NIVEL -->
                    <div class="glass-panel rounded-lg p-4 border border-indigo-600/30 text-center">
                        <div class="text-3xl font-black text-indigo-400 mb-1" id="profileLevel">1</div>
                        <div class="text-xs text-slate-400 uppercase tracking-widest">NIVEL</div>
                    </div>

                    <!-- ORO -->
                    <div class="glass-panel rounded-lg p-4 border border-amber-600/30 text-center">
                        <div class="text-3xl font-black text-amber-400 mb-1" id="profileGold">0</div>
                        <div class="text-xs text-slate-400 uppercase tracking-widest">ORO</div>
                    </div>

                    <!-- LOGROS -->
                    <div class="glass-panel rounded-lg p-4 border border-purple-600/30 text-center">
                        <div class="text-3xl font-black text-purple-400 mb-1" id="profileAchievementsCount">0</div>
                        <div class="text-xs text-slate-400 uppercase tracking-widest">LOGROS</div>
                    </div>
                </div>

                <!-- BARRA DE EXPERIENCIA -->
                <div class="glass-panel rounded-lg p-4 border border-purple-600/30">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs text-slate-400 uppercase tracking-widest">Experiencia</span>
                        <span class="text-xs text-purple-400 font-bold" id="profileXPText">0/1000 XP</span>
                    </div>
                    <div class="w-full bg-slate-800 h-4 rounded-full overflow-hidden border border-purple-700/50">
                        <div id="profileXPBarLarge"
                            class="bg-gradient-to-r from-purple-500 via-indigo-500 to-blue-500 h-full w-0 transition-all duration-1000 shadow-[0_0_10px_rgba(168,85,247,0.5)]">
                        </div>
                    </div>
                    <div class="mt-2 text-[10px] text-slate-500">
                        <span id="profileXPPercent">0%</span> - <span id="profileNextLevel">PrÃ³ximo nivel: 1000
                            XP</span>
                    </div>
                </div>

                <!-- CERRAR SESIÃ“N -->
                <div class="glass-panel rounded-lg p-4 border border-red-900/30">
                    <button onclick="logoutUser(this)"
                        class="w-full flex items-center justify-center gap-2 text-red-400 hover:text-red-300 hover:bg-red-950/30 transition-colors py-2 rounded-lg text-sm font-semibold tracking-wider">
                        <span>ðŸšª</span>
                        <span>CERRAR SESIÃ“N</span>
                    </button>
                </div>

            </div>
        </main>

        <!-- INPUT DEL CHAT (Solo visible en Diario) -->
        <div id="chatFooter" class="p-4 border-t border-slate-700 bg-slate-900/80">
            <div class="flex items-end gap-2">
                <div
                    class="flex-1 flex items-start gap-2 text-amber-500 bg-black/20 p-2 rounded border border-slate-700/50">
                    <span class="pt-2.5">></span>
                    <textarea id="chatInput" class="sam-input placeholder-slate-600 resize-none overflow-y-auto max-h-40"
                        rows="1" placeholder="Escribe tu gesta aquÃ­..." autocomplete="off"></textarea>
                </div>
                <button id="sendGestaBtn"
                    class="bg-amber-600 hover:bg-amber-500 text-black font-bold p-2 px-4 rounded shadow-lg transition-transform active:scale-95 flex items-center justify-center h-10">
                    <span class="text-xs">ENVIAR</span>
                </button>
            </div>
        </div>

        <!-- BARRA DE NAVEGACIÃ“N (TAB BAR) -->
        <nav
            class="bg-black/60 border-t border-amber-900/30 p-2 flex justify-around items-center rounded-b-xl backdrop-blur-md">
            <button
                class="nav-btn active group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-amber-500"
                data-target="journal">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F4DC;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">DIARIO</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="warRoom">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F5FA;&#xFE0F;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">MAPA</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="profile">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F464;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">PERFIL</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="backpack">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F392;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">MOCHILA</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="forge">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x2692;&#xFE0F;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">FORJA</span>
            </button>
            <button
                class="nav-btn group flex flex-col items-center gap-1 p-2 w-16 rounded hover:bg-white/5 transition-colors text-slate-500 hover:text-amber-500"
                data-target="achievementsTab">
                <span class="text-xl grayscale group-[.active]:grayscale-0 transition-all">&#x1F3C6;</span>
                <span class="text-[9px] font-bold tracking-wider opacity-50 group-[.active]:opacity-100">LOGROS</span>
            </button>
        </nav>

    </div>

    <!-- Panel de Desarrollador para Time Mocking -->
    <div id="devPanel" class="hidden dev-panel">
        <h4 class="font-bold mb-2">MÃ¡quina del Tiempo</h4>
        <label for="daysOffset">Adelantar DÃ­as:</label>
        <input type="number" id="daysOffset" value="0" class="bg-slate-800 text-amber-400 w-16 text-center">
        <button id="timeTravelBtn" class="bg-amber-600 text-black px-2 py-1 rounded">Viajar</button>
    </div>

    <script src="js/frontend/client.js?v=2.0"></script>

    <!-- Service Worker Registration & Easter Eggs -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((reg) => {
                        console.log('âœ… Service Worker registrado exitosamente:', reg);
                    })
                    .catch((err) => {
                        console.warn('âš ï¸ Error registrando Service Worker:', err);
                    });
            });
        }

        // Easter Egg: Comando de crÃ©ditos en consola
        window.credits = function () {
            console.clear();
            console.log('%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #fbbf24; font-weight: bold');
            console.log('%cðŸ† S.A.M. - EL LIBRO ROJO', 'color: #fbbf24; font-size: 16px; font-weight: bold');
            console.log('%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #fbbf24; font-weight: bold');
            console.log('%cForjado por:', 'color: #e2e8f0; font-weight: bold');
            console.log('%cJavier GonzÃ¡lez Olivera', 'color: #fbbf24; font-size: 14px; font-weight: bold');
            console.log('%c', 'color: #e2e8f0');
            console.log('%cTrabajo Final de MÃ¡ster 2026', 'color: #94a3b8; font-style: italic');
            console.log('%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #fbbf24; font-weight: bold');
            console.log('%cðŸ—¡ï¸ "No todo lo que brilla es oro, pero toda gesta cuenta" - Gandalf', 'color: #cbd5e1; font-style: italic');
            console.log('%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #fbbf24; font-weight: bold');
        };
    </script>

</body>

</html>



Bloque 1: Configuración del Campo de Pruebas (Jest & TDD)
Contexto: Necesitamos el escudo (tests) antes que la espada.
Prompt:
"SAM, iniciamos la Fase 1 del Día 01. Necesito configurar el entorno de Testing (TDD).
Genera el comando para instalar jest, supertest y dotenv como dependencias de desarrollo.

Crea un archivo de configuración de Jest básico.

Implementa una estructura de carpetas /tests y genera el primer test de prueba (smoke test) para verificar que el servidor responde.

Explícame cómo vamos a 'hardcorear' el tiempo mediante una variable global o inyección en las funciones para que podamos simular el paso de los días en los tests sin esperar tiempo real.Aplica mentalidad 'Siempre a Muerte' y tono JARVIS. Cero rodeos."

Bloque 2: La Cerradura de Isildur (Supabase Auth)Contexto: Eliminamos el user_id: null y cerramos el sistema.
Prompt:
"Entorno de test verificado. Ahora, vamos a blindar el acceso.

Modifica el server.js para integrar el sistema de Autenticación de Supabase.

Crea un Middleware de Validación que verifique el JWT (token) en cada petición a /api/briefing y /api/tasks.

Refactoriza las rutas actuales para que el user_id se extraiga automáticamente del usuario autenticado y no sea un valor nulo o estático.

Escribe un test con Supertest que falle (401 Unauthorized) si intento anotar una gesta sin estar logueado.Recuerda usar español técnico preciso y terminología RPG."

Bloque 3: El Algoritmo de Asedio (Lógica de Horda)
Contexto: La matemática pura de la sombra. Aquí aplicamos las fórmulas de Exploradores, Orcos y Uruk-Hais.
Prompt:
"Usuario autenticado. Procedemos a la forja del Motor de Asedio. Necesito una función pura llamada calcularHorda(fechaFallo, fechaReferencia).

La lógica debe seguir estas reglas:
    Exploradores: $n = \text{días transcurridos}$.
    Orcos: $n = \lfloor \text{días} / 3 \rfloor$.
    Uruk-Hai: $n = \lfloor \text{días} / 5 \rfloor$.

Aplica el Time Mocking que configuramos antes para que la función acepte una fechaReferencia externa.

Escribe un set de tests unitarios que validen:
Caso 0: Tarea fallada hoy = 0 enemigos.
Caso 1: Tarea fallada hace 3 días = 3 Exploradores, 1 Orco, 0 Uruk-Hai.
Caso 2: Tarea fallada hace 6 días = 6 Exploradores, 2 Orcos, 1 Uruk-Hai.

Integra esta lógica en la ruta que consulta las misiones para que los contadores se calculen al vuelo antes de enviarlos al frontend."

Bloque 4: El Juicio de Mithrandir (Validación de Fin de Ciclo)
Contexto: El cierre del día y el interrogatorio de Gandalf.
Prompt:
"El asedio ya tiene lógica. Ahora implementamos el Protocolo de Juicio.
Crea una ruta POST /api/gandalf/judge que reciba un array de IDs de tareas.

Si el usuario marca 'Fracaso', la tarea debe actualizarse en la DB con is_completed: false, fallo_confirmado: true y la fecha_fallo actual.

Si marca 'Éxito', procesa un loot básico (un mensaje de confirmación por ahora).

Implementa el test de integración: Simular un juicio de Gandalf sobre una tarea pendiente y verificar que en la base de datos se activa la semilla de la horda correctamente.Dame el código limpio, segmentado y listo para entrar en la rama feature/sistema-nemesis-horda."